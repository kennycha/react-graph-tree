1. 개요

목표: 내부 팀이 ComfyUI 유사 UX로, 감지(detector) → 추적(tracker) → G/A → SF → 이벤트 등 ML 분석 파이프라인을 시각적으로 구성할 수 있는 웹 전용 에디터 제공.

범위(이번 스프린트): 그래프 편집 UI/UX와 그래프 유효성 검사. 실행 엔진, 파일 import/export, 협업 기능은 비범위.

플랫폼: 최신 데스크톱 브라우저. 모바일/터치는 고려하지 않음.

테크 스택: React + Styled-Components. 상태관리는 초기엔 Context + useState로 시작, 필요시 Zustand로 전환 가능.

2. 그래프 모델 요구사항

구조: 방향성 데이터플로우 DAG (사이클 금지).

연결성: 상위노드:하위노드 = 1:N.

각 노드는 들어오는 간선 ≤ 1, 나가는 간선 ≥ 0 (다수 가능).

노드 페이로드: 각 노드는 내부 객체형 데이터를 보유(필드 스키마는 팀이 개발 중 정의, 에디터는 투명 운반).

타입: 최소 5종(Detector, Tracker, G/A, SF, Event). 타입별 아이콘/색상만 구분.

타입 간 연결 규칙은 허용(추후 세분화 가능).

호환성: 포트 타입 강제 검증은 이번 범위에서 최소화(ComfyUI 유사 느슨한 모델). 추후 필요 시 어댑터 노드 도입.

3. 핵심 사용자 시나리오 (MVP)

노드 추가: 빈 캔버스/우클릭 메뉴에서 노드 타입 선택 → 캔버스에 배치.

노드 이동: 드래그로 위치 조정. 격자 스냅은 미적용(옵션).

노드 연결: 좌측(입력) ↔ 우측(출력) 포트 간 드래그로 연결.

들어오는 간선이 이미 1개인 노드에는 추가 연결 불가.

불가 시 시각적 에러 힌트 제공.

노드 선택/삭제: 단일 선택 → Delete 액션(버튼/우클릭 메뉴). 멀티 선택/그룹 없음.

줌/패닝: 휠 줌, 드래그 패닝(스페이스 없이 캔버스 빈 곳 드래그).

우클릭 메뉴: 노드/캔버스 컨텍스트별 항목 제공(아래 6장).

저장/불러오기(내부): 앱 메모리/상태에 JS 객체로 보관. 파일 import/export 제공하지 않음.

선 스타일: ComfyUI 유사 곡선 라우팅, 연결 시 포트 하이라이트.

4. UI 구조(컴포넌트 개요)

GraphCanvas: 패닝/줌, 그리드 배경(옵션), 글로벌 마우스/휠 이벤트 관리.

NodeCard: 타입 배지, 제목, 간단 요약(객체 데이터의 요약 문자열), 좌/우 포트 렌더.

Port(Input/Output): 호버 시 하이라이트, 연결 가능 여부 표시.

EdgeLayer: 모든 간선의 SVG 렌더 레이어. 연결 중 상태(고무줄) 표현.

ConnectionOverlay: 연결 시작→목표 포트까지의 임시 라인, 에러 메시지/툴팁.

ContextMenu: 캔버스용과 노드용 두 종류.

ZoomControls(옵션): +/−, 100% 리셋 버튼(우측 하단).

StatusBar(옵션): 노드 수, 선택 상태, 경고 표시.

디자인/테마는 Styled-Components의 ThemeProvider 토큰으로만 추상화(색/간격/폰트). 실제 스타일 토큰 값은 별도 디자인 규격서에서 정의.

5. 인터랙션 & 동작 규칙
   5.1 연결 규칙

연결 방향: 좌(입력) ← 우(출력), 시각적으로는 우 → 좌 드래그.

들어오는 간선 1개 제한: 이미 연결된 입력 포트에 새 연결을 시도하면 시각적 에러(쉐이크/레드 글로우)와 토스트 “이 노드는 하나의 상위 노드만 가질 수 있습니다”.

사이클 방지: 간선 추가 시 경로 탐색으로 즉시 검증. 사이클이 생기면 추가 불가.

삭제 전파 없음: 상위 노드 삭제 시, 하위 노드의 입력은 끊기되 노드는 유지.

5.2 노드 조작

드래그 이동: 노드 본체를 드래그. 리사이즈/폴딩 없음(초기 버전 단순화).

선택: 단일 선택만 지원. 키보드 단축키는 미구현.

5.3 캔버스

패닝: 빈 공간 드래그.

줌: 휠 중심 줌. 최소/최대 배율 제한(예: 0.25x ~ 2.0x 수준).

그리드: 옅은 도트/라인 그리드(옵션). 스냅은 기본 비활성.

6. 컨텍스트 메뉴 설계

캔버스 우클릭

새 노드 추가 ▸ Detector / Tracker / G/A / SF / Event

보기 ▸ 줌 인 / 줌 아웃 / 100% / 화면에 맞춤(옵션)

자동 레이아웃(옵션)

노드 우클릭

노드 복제(동일 데이터 복사)

연결 끊기(모든 입력/출력)

삭제

데이터 보기(읽기 전용 패널; 내부 객체의 요약만 표시)

타입 변경(옵션: 동형 포트 전제 시)

7. 상태관리/아키텍처

초기: Context + useState로 그래프/선택 상태/뷰 포즈(줌, 패닝) 관리.

확장 옵션: 편집 이력이 필요해지면 Zustand(+Immer)로 전환하여 부분 구독/리렌더 최적화.

렌더링 전략:

노드: DOM(Card)로 렌더(드래그 성능 확보 용이).

엣지: 단일 SVG 레이어로 path 렌더(곡선, 하이라이트, 히트영역 따로).

뷰 트랜스폼은 **CSS transform(scale/translate)**로 적용.

성능 가정: 노드/엣지 수가 수십 단위(수백 미만) → 가상화 불필요.

8. 데이터(개념 레벨)

Graph: 노드 목록, 엣지 목록, 뷰 상태(줌/오프셋).

Node: 고유 ID, 타입(Detector/Tracker/… ), 표시 이름, 위치(x,y), payload(객체).

Edge: 고유 ID, source(nodeId), target(nodeId).

제약: target은 그래프 내에서 유일한 상위(source)만 허용.

내부 사용만 전제. 외부 파일 import/export 기능은 제공하지 않음. 필요 시 앱 외부 모듈에서 직렬화/역직렬화 유틸만 추가.

9. 유효성 검사 & 에러 처리

사이클 검사: 간선 추가 시 DFS/BFS로 즉시 검증 → 불가 시 사용자 피드백.

1:N 검사: target에 기존 간선 존재 시 연결 불가.

삭제 안전성: 노드 삭제 시 연결된 간선 모두 정리.

시각적 피드백: 포트 호환 가능 시 호버 하이라이트, 불가 시 레드/툴팁.

10. 자동 레이아웃(옵션)

DAG 전용 단순 레이어드 레이아웃(좌→우) 제공.

사용 시 노드 간격/레이어 간격 파라미터만 제공.

초기 배치용; 이후 수동 배치 허용.
